# QoderResume Backup Configuration
# Main configuration file for backup and disaster recovery system

# =============================================================================
# BACKUP GENERAL SETTINGS
# =============================================================================
BACKUP_ENABLED=true
BACKUP_BASE_DIR=/var/backups/qoder-resume
BACKUP_LOG_DIR=/var/log/qoder-backup
BACKUP_TEMP_DIR=/tmp/qoder-backup

# Backup retention settings (in days)
DAILY_RETENTION=90
WEEKLY_RETENTION=365
MONTHLY_RETENTION=2555   # 7 years
TRANSACTION_LOG_RETENTION=1

# =============================================================================
# DATABASE BACKUP CONFIGURATION
# =============================================================================
DB_BACKUP_ENABLED=true
DB_HOST=${DATABASE_HOST:-localhost}
DB_PORT=${DATABASE_PORT:-5432}
DB_NAME=${DATABASE_NAME:-qoder_resume}
DB_USER=${DATABASE_USERNAME:-postgres}
DB_PASSWORD=${DATABASE_PASSWORD}

# Database backup settings
DB_BACKUP_TYPE=full          # full, incremental
DB_COMPRESSION=gzip          # gzip, bzip2, none
DB_COMPRESSION_LEVEL=6       # 1-9 (6 is good balance)
DB_PARALLEL_JOBS=4           # Number of parallel backup jobs
DB_BACKUP_FORMAT=custom      # custom, plain, tar

# Point-in-time recovery settings
PITR_ENABLED=true
WAL_ARCHIVE_ENABLED=true
WAL_ARCHIVE_DIR=/var/backups/qoder-resume/wal
WAL_RETENTION_HOURS=72

# =============================================================================
# FILE STORAGE BACKUP CONFIGURATION
# =============================================================================
FILE_BACKUP_ENABLED=true
FILE_SOURCE_DIRS="/app/uploads,/app/storage,/app/logs"
FILE_EXCLUDE_PATTERNS="*.tmp,*.log,*.cache,node_modules"
FILE_COMPRESSION=true
FILE_ENCRYPTION=true

# Rsync settings
RSYNC_BANDWIDTH_LIMIT=50000  # KB/s (50MB/s)
RSYNC_TIMEOUT=3600          # seconds
RSYNC_RETRIES=3

# =============================================================================
# REDIS BACKUP CONFIGURATION
# =============================================================================
REDIS_BACKUP_ENABLED=true
REDIS_HOST=${REDIS_HOST:-localhost}
REDIS_PORT=${REDIS_PORT:-6379}
REDIS_PASSWORD=${REDIS_PASSWORD}
REDIS_BACKUP_RDB=true
REDIS_BACKUP_AOF=true

# =============================================================================
# CLOUD STORAGE CONFIGURATION
# =============================================================================
CLOUD_BACKUP_ENABLED=true
CLOUD_PROVIDER=aws          # aws, azure, gcp
CLOUD_REGION=us-east-1
CLOUD_BUCKET=qoder-resume-backups
CLOUD_STORAGE_CLASS=STANDARD_IA

# AWS S3 Configuration
AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
AWS_DEFAULT_REGION=${CLOUD_REGION}

# Cross-region replication
CROSS_REGION_BACKUP=true
CROSS_REGION_BUCKET=qoder-resume-backups-dr
CROSS_REGION=us-west-2

# =============================================================================
# ENCRYPTION CONFIGURATION
# =============================================================================
ENCRYPTION_ENABLED=true
ENCRYPTION_METHOD=aes256     # aes256, aes128
ENCRYPTION_KEY_FILE=/etc/qoder-backup/encryption.key
GPG_RECIPIENT=backup@qoderresume.com
GPG_KEY_ID=

# =============================================================================
# MONITORING & ALERTING
# =============================================================================
MONITORING_ENABLED=true
HEALTH_CHECK_URL=
ALERT_EMAIL=ops@qoderresume.com
ALERT_SLACK_WEBHOOK=
ALERT_ON_FAILURE=true
ALERT_ON_WARNING=true
ALERT_ON_SLOW_BACKUP=true

# Performance thresholds
BACKUP_TIME_WARNING_THRESHOLD=3600    # seconds (1 hour)
BACKUP_TIME_CRITICAL_THRESHOLD=7200   # seconds (2 hours)
STORAGE_USAGE_WARNING_THRESHOLD=80    # percentage
STORAGE_USAGE_CRITICAL_THRESHOLD=90   # percentage

# =============================================================================
# SCHEDULE CONFIGURATION
# =============================================================================
# Cron expressions for backup schedules

# Database backups
DB_FULL_BACKUP_SCHEDULE="0 2 * * *"        # Daily at 2:00 AM
DB_INCREMENTAL_SCHEDULE="0 */6 * * *"       # Every 6 hours
DB_WAL_BACKUP_SCHEDULE="*/15 * * * *"       # Every 15 minutes

# File backups
FILE_BACKUP_SCHEDULE="0 3 * * *"            # Daily at 3:00 AM

# Redis backups
REDIS_BACKUP_SCHEDULE="0 */2 * * *"         # Every 2 hours

# Configuration backups
CONFIG_BACKUP_SCHEDULE="0 1 * * *"          # Daily at 1:00 AM

# Cleanup old backups
CLEANUP_SCHEDULE="0 4 * * *"                # Daily at 4:00 AM

# =============================================================================
# TESTING CONFIGURATION
# =============================================================================
TESTING_ENABLED=true
TEST_RESTORE_SCHEDULE="0 5 * * 0"           # Weekly on Sunday at 5:00 AM
TEST_DATABASE_NAME=qoder_resume_test_restore
TEST_NOTIFICATION_EMAIL=qa@qoderresume.com

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================
# Maximum parallel backup processes
MAX_PARALLEL_BACKUPS=3

# Network bandwidth limits
BANDWIDTH_LIMIT_LOCAL=100000     # KB/s for local operations
BANDWIDTH_LIMIT_CLOUD=50000      # KB/s for cloud uploads

# Memory limits
BACKUP_MEMORY_LIMIT=2G           # Maximum memory per backup process

# Disk I/O priority
BACKUP_IO_PRIORITY=7             # ionice priority (0-7, 7 is lowest)

# =============================================================================
# DISASTER RECOVERY CONFIGURATION
# =============================================================================
DR_ENABLED=true
DR_SITE_REGION=us-west-2
DR_DATABASE_INSTANCE=qoder-resume-dr
DR_DNS_FAILOVER_TTL=60           # seconds

# Recovery objectives
RTO_TARGET=14400                 # 4 hours in seconds
RPO_TARGET=3600                  # 1 hour in seconds

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
LOG_LEVEL=INFO                   # DEBUG, INFO, WARN, ERROR
LOG_ROTATION=daily
LOG_RETENTION_DAYS=30
LOG_FORMAT=json                  # json, text

# Backup operation logging
LOG_BACKUP_START=true
LOG_BACKUP_PROGRESS=true
LOG_BACKUP_COMPLETION=true
LOG_BACKUP_VERIFICATION=true

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================
# Access control
BACKUP_USER=qoder-backup
BACKUP_GROUP=qoder-backup
BACKUP_PERMISSIONS=750

# Network security
BACKUP_NETWORK_ENCRYPTION=true
BACKUP_VPN_REQUIRED=false
ALLOWED_SOURCE_IPS=

# Audit logging
AUDIT_LOGGING_ENABLED=true
AUDIT_LOG_FILE=/var/log/qoder-backup/audit.log

# =============================================================================
# MAINTENANCE CONFIGURATION
# =============================================================================
MAINTENANCE_WINDOW_START="02:00"
MAINTENANCE_WINDOW_END="06:00"
MAINTENANCE_TIMEZONE="UTC"

# Auto-cleanup settings
AUTO_CLEANUP_ENABLED=true
CLEANUP_FAILED_BACKUPS=true
CLEANUP_INCOMPLETE_BACKUPS=true
CLEANUP_CORRUPTED_BACKUPS=true

# Vacuum and optimization
DB_VACUUM_BEFORE_BACKUP=true
DB_ANALYZE_AFTER_RESTORE=true

# =============================================================================
# COST OPTIMIZATION
# =============================================================================
COST_OPTIMIZATION_ENABLED=true
STORAGE_TIERING_ENABLED=true

# Storage lifecycle rules (days)
LIFECYCLE_TRANSITION_IA=30       # Standard to Infrequent Access
LIFECYCLE_TRANSITION_GLACIER=90   # IA to Glacier
LIFECYCLE_TRANSITION_DEEP_ARCHIVE=365  # Glacier to Deep Archive
LIFECYCLE_EXPIRATION=2555        # Delete after 7 years

# Compression optimization
ADAPTIVE_COMPRESSION=true
COMPRESSION_ANALYSIS=true
DEDUPLICATION_ENABLED=true